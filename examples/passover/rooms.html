<!DOCTYPE html>
<meta charset="utf-8">
<html>
<head>
  <script>
    var ws_pub = new WebSocket('ws://localhost:8001/events/positions');
    var ws_sub = new WebSocket('ws://localhost:8001/rooms/visitors/count');

    ws_sub.onmessage = function(event) {
      console.log('Msg received: ' + event.data);
    };

    ws_pub.onopen = function() {
      console.log('Websocket pub opened');
    };
    ws_pub.onerror = function(error) {
      console.log('Websocket pub error: ' + error.data);
    };
    ws_pub.onclose = function() {
      console.log('Websocket pub closed');
    };

    ws_sub.onopen = function() {
      console.log('Websocket sub opened');
    };
    ws_sub.onerror = function(error) {
      console.log('Websocket sub error: ' + error.data);
    };
    ws_sub.onclose = function() {
      console.log('Websocket sub closed');
    };

    function send_position(visitor,x,y) {
      x = Math.trunc(x / 200);
      y = Math.trunc(y / 150);
      timestamp = (new Date()).getTime();
      room = "R"+ x + "." + y;
      e = '{ "visitor": "'+ visitor +'", "room": "'+ room +'", "timestamp": '+ timestamp +' }';
    
      ws_pub.send(e);
      console.log('Msg sent: ' + e);
    };

    function position(e) {
      var svgDiv = document.getElementById("svgDiv");
      var box = svgDiv.getBoundingClientRect();
      x = e.clientX - box.left;
      y = e.clientY - box.top;

      if (x >= 0 && x < 1000 && y >= 0 && y < 600) {
        send_position("V001", x , y)
      }
    }
  </script>
</head>

<body>
<div id="svgDiv" align="center" width="1000" height="600" onmousemove="position(event)">
<svg width="1000" height="600">
  <rect x="0" y="0" width="200" height="150" fill="#EEEEEC" stroke="#204A87" stroke-width="5" />
  <rect x="200" y="0" width="200" height="150" fill="#EEEEEC" stroke="#204A87" stroke-width="5" />
  <rect x="400" y="0" width="200" height="150" fill="#EEEEEC" stroke="#204A87" stroke-width="5" />
  <rect x="600" y="0" width="200" height="150" fill="#EEEEEC" stroke="#204A87" stroke-width="5" />
  <rect x="800" y="0" width="200" height="150" fill="#EEEEEC" stroke="#204A87" stroke-width="5" />

  <rect x="0" y="150" width="200" height="150" fill="#EEEEEC" stroke="#204A87" stroke-width="5" />
  <rect x="200" y="150" width="200" height="150" fill="#EEEEEC" stroke="#204A87" stroke-width="5" />
  <rect x="400" y="150" width="200" height="150" fill="#EEEEEC" stroke="#204A87" stroke-width="5" />
  <rect x="600" y="150" width="200" height="150" fill="#EEEEEC" stroke="#204A87" stroke-width="5" />
  <rect x="800" y="150" width="200" height="150" fill="#EEEEEC" stroke="#204A87" stroke-width="5" />

  <rect x="0" y="300" width="200" height="150" fill="#EEEEEC" stroke="#204A87" stroke-width="5" />
  <rect x="200" y="300" width="200" height="150" fill="#EEEEEC" stroke="#204A87" stroke-width="5" />
  <rect x="400" y="300" width="200" height="150" fill="#EEEEEC" stroke="#204A87" stroke-width="5" />
  <rect x="600" y="300" width="200" height="150" fill="#EEEEEC" stroke="#204A87" stroke-width="5" />
  <rect x="800" y="300" width="200" height="150" fill="#EEEEEC" stroke="#204A87" stroke-width="5" />

  <rect x="0" y="450" width="200" height="150" fill="#EEEEEC" stroke="#204A87" stroke-width="5" />
  <rect x="200" y="450" width="200" height="150" fill="#EEEEEC" stroke="#204A87" stroke-width="5" />
  <rect x="400" y="450" width="200" height="150" fill="#EEEEEC" stroke="#204A87" stroke-width="5" />
  <rect x="600" y="450" width="200" height="150" fill="#EEEEEC" stroke="#204A87" stroke-width="5" />
  <rect x="800" y="450" width="200" height="150" fill="#EEEEEC" stroke="#204A87" stroke-width="5" />
</svg>
</div>
</body>
</html>
